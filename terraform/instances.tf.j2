{% if should_preserve_instances|default(false)|bool and current_instances_metadata != "" %}
{% for instance in current_instances_metadata %}
resource "aws_instance" "{{ instance.split(',')[0] }}" {
  # ...instance configuration...
}

resource "aws_network_interface_sg_attachment" "{{ instance.split(',')[0] }}" {
  security_group_id    = "${aws_security_group.target_security_group.id}"
  network_interface_id = "{{ instance.split(',')[1] }}"
}
{% endfor %}
{% endif %}